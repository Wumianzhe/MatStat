#+title: Лабораторная работа
#+LANGUAGE: ru
#+LATEX_CLASS: article
#+LATEX_CLASS_OPTIONS: [a4paper,fleqn,12pt]
#+LATEX_HEADER: \usepackage[lmargin=15mm, rmargin=15mm, tmargin=2cm, bmargin=2cm]{geometry}

* Постановка задачи
#+name: imports
#+begin_src julia :exports none :session :results none :tangle histograms.jl
using Random, Distributions, StatsPlots
#+end_src

Для 5 распределений:
- Нормальное распределение \(N(x,0,1)\)
  #+name: distr_normal
  #+begin_src julia :exports none
name = "Normal"
d = Normal(0,1)
  #+end_src
- Распределение Коши \(C(x,0,1)\)
  #+name: distr_cauchy
  #+begin_src julia :exports none
name = "Cauchy"
d = Cauchy(0,1)
  #+end_src
- Распределение Лапласа \(L(x,0,\frac{1}{\sqrt{2}})\)
  #+name: distr_laplace
  #+begin_src julia :exports none
name = "Laplace"
d = Laplace(0,1/sqrt(2))
  #+end_src
- Распределение Пуассона \(P(k,10)\)
  #+name: distr_poisson
  #+begin_src julia :exports none
name = "Poisson"
d = Poisson(10)
  #+end_src
- Равномерное распределение \(U(x,-\sqrt{3},\sqrt{3})\)
  #+name: distr_uniform
  #+begin_src julia :exports none
name = "Uniform"
d = Uniform(-sqrt(3),sqrt(3))
  #+end_src
​​
#+begin_export latex
\begin{enumerate}
  \item  Сгенерировать выборки размером 10, 50 и 1000 элементов. Построить на одном
рисунке гистограмму и график плотности распределения.
  \item  Сгенерировать выборки размером 10, 100 и 1000 элементов. Для каждой выборки
   вычислить следующие статистические характеристики положения данных:
   \(\overline{x}, med x, z_{R},z_{Q},z_{tr}\). Повторить такие вычисления 1000 раз для
   каждой выборки и найти среднее характеристик положения и их квадратов. \begin{equation}
   E(z) = \overline{z}
   \end{equation}
    Вычислить оценку дисперсии по формуле \begin{equation}
D(z) = \overline{z^2} - \overline{z}^2
\end{equation}
    Представить полученные данные в виде таблиц.
  \item  Сгенерировать выборки размером 20 и 100 элементов. Построить для них боксплот
   Тьюки.

Для каждого распределения определить долю выбросов экспериментально (сгенерировав
выборку, соответствующую распределению 1000 раз, и вычислив среднюю долю выбросов) и
сравнить с результатами, полученными теоритически.

\item Сгенерировать выборки размером 20, 60 и 100 элементов. Построить на них эмпирические
функции распределения и ядерные оценки плотности распределения на отрезке \([-4;4]\) для
непрерывных распределений и на отрезке \([6;14]\) для распределения Пуассона
\end{enumerate}
#+end_export
* Теория
** Рассматриваемые распределения
Плотности:
#+begin_export latex
\begin{itemize}
  \item Нормальное распределение \begin{equation}
N(x,0,1) = \frac{1}{\sqrt{2\pi}} e^{- \frac{x^2}{2}}
  \end{equation}
  \item Распределение Коши
\begin{equation}
C(x,0,1) = \frac{1}{\pi} \frac{1}{x^2 + 1}
\end{equation}
  \item Распределение Лапласа
\begin{equation}
L(x,0,\frac{1}{\sqrt{2}}) = \frac{1}{2\sqrt{2}} e^{-\sqrt{2}\abs{x}}
\end{equation}
  \item Распределение Пуассона
\begin{equation}
P(k,10) = \frac{10^{k}}{k!}e^{-10}
\end{equation}
  \item Равномерное распределение
\begin{equation}
U(x, -\sqrt{3},\sqrt{3}) = \begin{cases}
                             \frac{1}{2\sqrt{3}} \text{ при } \abs{x} \leq \sqrt{3}\\
                             0 \text{ при } \abs{x} > \sqrt{3}
                           \end{cases}
\end{equation}
\end{itemize}
#+end_export
** Гистограмма
#+name: histogram
#+begin_src julia
parr = fill(plot(),3,1);
xmin = -5;
xmax = 5;
x = range(xmin,xmax,101);
sizes = [10,50,1000]
bins = [10,20,50]
for (i,size) in enumerate(sizes)
    sample = rand(d,size);
    parr[i] = histogram(sample, normalize = :pdf,bins=range(xmin,xmax,length=bins[i]+1), legend=false, title="$name distribution n=$size", xlimits=(xmin,xmax));
    plot!(parr[i],x, pdf.(d,x),linewidth=1.5);
end
dplot = plot(parr...,layout=(1,3),dpi=300,size=(1500,350));
savefig(dplot,"figs/hist" * name)
#+end_src
*** Построение гистограммы

Множество значенией, которое может принимать элемент выборки, разбивается на
несколько интервалов. Чаще всего эти интервалы берут одинаковыми, но это не
является строгим требованием. Эти интервалы откладываются на горизонтальной оси,
затем над каждым рисуется прямоугольник. Если все интервалы были одинаковыми, то
высота каждого прямоугольника пропорциональна числу элементов выборки,
попадающих в соответствующий интервал. Если интервалы разные, то высота
прямоугольника выбирается таким образом, чтобы его площадь была пропорциональна
числу элементов выборки, которые попали в этот интервал.
** Вариационный ряд

Вариационный ряд --- последовательность элементов выборки, расположенных в
неубывающем порядке. Одинаковые элементы повторяются.
** Выборочные числовые характеристики
*** Характеристики положения

#+begin_export latex
\begin{itemize}
  \item Выборочное среднее
\begin{equation}
\overline{x} = \frac{1}{n} \sum_{i=1}^{n}x_i
\end{equation}

  \item Выборочная медиана
\begin{equation}
med\ x = \begin{cases}
           x_{(l+1)} \text{ при } n = 2l + 1\\
           \frac{x_{(l)} + x_{(l+1)}}{2} \text{ при } n = 2l
         \end{cases}
\end{equation}

  \item Полусумма экстремальных выборочных элементов
\begin{equation}
z_{R} = \frac{x_{(1)} + x_{(n)}}{2}
\end{equation}

  \item Полусумма квартилей

        Выборочная квартиль \(z_{p}\) порядка \(p\) определяется формулой
\begin{equation}
z_{p} = \begin{cases}
          x_{([np]+1)} \text{ при } np \text{ дробном }\\
          x_{(np)} \text{ при } np \text{ целом }
        \end{cases}
\end{equation}
        Полусумма квартилей
\begin{equation}
z_{Q} = \frac{z_{1 / 4} + z_{3 / 4}}{2}
\end{equation}

  \item Усечённое среднее
\begin{equation}
  z_{tr} = \frac{1}{n - 2r} \sum_{i=r+1}^{n-r} x_{(i)}, \\ r \approx \frac{n}{4}
\end{equation}
\end{itemize}
#+end_export
*** Характеристики рассеяния

Выборочная дисперсия
\begin{equation}
  D = \frac{1}{n} \sum_{i=1}^n (x_i - \overline{x})^2
\end{equation}

** Боксплот Тьюки

*** Построение

Границами ящика --- первый и третий квартили, линия в середине ящика ---
медиана. Концы усов --- края статистически значимой выборки (без выбросов).
Длина "усов":
#+name: eqn:1
\begin{equation}
X_{1} = Q_{1} - \frac{3}{2}(Q_{3} - Q_{1}),\quad X_{2} = Q_{3} + \frac{3}{2} (Q_{3} - Q_{1})
\end{equation}

где $X_1$ --- нижняя граница уса, $X_2$ --- верхняя граница уса, $Q_1$ ---
первый квартиль, $Q_3$ --- третий квартиль. Данные, выходящие за границы усов
(выбросы) отображаются на графике в виде маленьких кружков.
** Теоретическая вероятность выбросов

Можно вычислить теоритические первый и тертий квартили распределений --- \(Q_{1}^{T}\)
и \(Q_{3}^{T}\). По ф-ле [[eqn:1]] --- теоретические нижнюю и верхнюю границы уса ---
\(X_{1}^{T}\) и \(X_{2}^{T}\). Выбросы --- величины $x$:
\begin{equation}
  \left[
\begin{split}
  x < X_{1}^{T}\\
  x > X_2^{T}
\end{split}
  \right.
\end{equation}

Теоретическая вероятность выбросов:
- для непрерывных распределений
  \begin{equation}
  P_{B}^{T} = P(x < X_1^{T}) + P(x > X_2^{T}) = F(X_1^{T}) + (1 - F(X_2^{T}))
  \end{equation}
- для дискретных распределений
  \begin{equation}
  P_{B}^{T} = P(x < X_{1}^{T}) + P(x > X_{2}^{T}) = \left( F(x_{1}^{T}) - P(x = X_{1}^{T}) \right) + (1 - F(X_{2}^{T}))
  \end{equation}

** Эмпирическая функция распределения

*** Статистический ряд

Статистический ряд --- последовательность различных элементов выборки
\(z_1,z_2,\ldots,z_k\), расположенных в возрастающем порядке с указанием частот
\(n_1,n_2,\ldots,n_k\), с которыми эти элементы содержатся в выборке. Обычно
записывается в виде таблицы
*** Эмпирическая функция распределения

Эмпирическая (выборочная) функция распределения (э.ф.р.) --- относительная
частота события $X < x$ , полученная по данной выборке:
\begin{equation}
F_{n}^{*}(x) = P^{*}(X < x)
\end{equation}

*** Нахождение э. ф. р.
Для получения относительной частоты $P^*(X < x)$ просуммрируем в статистическом
ряде, построенном по данной выборке, все частоты $n_i$ для которых элементы
\(z_i\) статистического ряда меньше $x$. Тогда \(P^{*}(X < x) = \frac{1}{n} \sum_{z_i<x}
n_{i}\). Получаем
\begin{equation}
  F^{*}(x) = \frac{1}{n} \sum_{z_{i} < x} n_i
\end{equation}
\(F^{*}(x)\) --- функция распределения дискретной случайной величины $X^*$,
заданной таблицей распределения
#+caption: Таблица распределения
| $X^*$ | $z_1$             | $z_2$             | ... | $z_k$             |
|-------+-------------------+-------------------+-----+-------------------|
| P     | \(\frac{n_1}{n}\) | \(\frac{n_2}{n}\) | ... | \(\frac{n_k}{n}\) |

Эмпирическая функция распределения является оценкой, т.е. приближённым
значением, генеральной функции распределения
\begin{equation}
F_{n}^{*}(x) \approx F_{X}(x)
\end{equation}
** Оценки плотности вероятности
*** Определение

Оценкой плотности вероятности \(f(x)\) наызвается функция \(\hat{f}(x)\),
построенная на основе выборки, приближённо равная $f(x)$
\begin{equation}
\hat{f}(x) \approx f(x)
\end{equation}


*** Ядерные оценки

Представим оценку в виде суммы с числом слагаемых, равным объёму выборки
\begin{equation}
  \hat{f_{n}}(x) = \frac{1}{n h_n} \sum_{i=1}^n K( \frac{x - x_k}{h_n} )
\end{equation}

Здесь функция \(K(u)\), называемая ядерной (ядром), непрерывна и является
плотностью вероятности, \(x_1,\ldots, x_n\) --- элементы выборки, \(\{h_n\}\) ---
любая последовательность положительных числе, обладающая свойствами
\begin{equation}
h_n \xrightarrow[n \to \infty]{} 0; \quad \frac{h_n}{n^{-1}} \xrightarrow[n \to \infty]{} \infty
\end{equation}

Такие оценки называются непрерывными ядерными

Гауссово (нормальное) ядро
\begin{equation}
K(u) = \frac{1}{\sqrt{2\pi}}e^{- \frac{u^2}{2}}
\end{equation}
Правило Сильвермана
\begin{equation}
h_n = 1.06\hat{\sigma} n^{-1 / 5}
\end{equation}

где \(\hat{\sigma}\) --- выборочное стандартное отклонение.
* Реализация

Лабораторная работа выполнена с помощью языка программирования ~Julia~. Исходный
код работы находится в репозитории github
* Результаты
** Гистограмма и график плотности распределения

#+name: Histogram Normal
#+begin_src julia :noweb yes :exports none :tangle histograms.jl :session :results none
<<distr_normal>>
<<histogram>>
#+end_src

#+name: Histogram Cauchy
#+begin_src julia :noweb yes :exports none :tangle histograms.jl :session :results none
<<distr_cauchy>>
<<histogram>>
#+end_src

#+name: Histogram Laplace
#+begin_src julia :noweb yes :exports none :tangle histograms.jl :session :results none
<<distr_laplace>>
<<histogram>>
#+end_src

#+name: Histogram Uniform
#+begin_src julia :noweb yes :exports none :tangle histograms.jl :session :results none
<<distr_uniform>>
<<histogram>>
#+end_src

#+name: Histogram Poisson
#+begin_src julia :noweb yes :exports none :tangle histograms.jl :session :results none
<<distr_poisson>>
parr = fill(plot(),3,1);
λ = params(d)[1];
sizes = [10,50,1000]
bins = [10,20,50]
poisPDF(x) = 1/sqrt(2pi * λ) * exp(-(x-λ)^2/(2λ)) # pdf(d,x) is only defined for natural x in Julia
for (i,size) in enumerate(sizes)
    sample = rand(d,size);
    xmin = minimum(sample);
    xmax = maximum(sample);
    x = range(xmin-3,xmax+3,151);
    # bins use Freedman-Diaconis rule
    parr[i] = histogram(sample, normalize= :pdf,  legend=false, title="Poisson distribution n=$size", xlimits=(xmin-3,xmax+3))
    plot!(parr[i],x, poisPDF.(x), linewidth=1.5);
end
dplot = plot(parr...,layout=(1,3),dpi=300,size=(1500,350));
savefig(dplot,"figs/hist" * name )
#+end_src

#+caption: Нормальное распределение
#+name: fig:1
[[./figs/histNormal.png]]

#+caption: Распределение Коши
#+name: fig:2
[[./figs/histCauchy.png]]

#+caption: Распределение Лапласа
#+name: fig:3
[[./figs/histLaplace.png]]

#+caption: Распределение Пуассона
#+name: fig:4
[[./figs/histPoisson.png]]

#+caption: Равномерное распределение
#+name: fig:5
[[./figs/histUniform.png]]

** Характеристики положения и рассеяния

/Как было проведено округление/: \\
В оценке \(x = E \pm D\) вариации подлежит первая цифра после точки. \\
В данном случае \(x = 0.0 \pm 0.1k\), $k$ --- зависит от доверительной вероятности
и вида распределения (рассматривается в дальнейшем цикле лабораторных работ)\\
Округление сделано для \(k = 1\)
** Боксплот Тьюки


** Доля выбросов

/Округление доли выбросов/:

Выборка случайна, поэтому в качестве оценки рассеяния можно взять дисперсию
пуассоновского потока: \(D_n \approx \sqrt{n}\)\\
Доля \(p_n = D_n / n = 1 / \sqrt{n}\)\\
Для \(n = 20: p_n = 1 / \sqrt{20}\) --- примерно 0.2 или 20%\\
Для \(n = 100: p_n = 0.1\) или 10%\\
Исходя из этого можно решить, сколько знаков оставлять в доле выбросов.
** Теоретическая вероятность выбросов
** Эмпирическая функция распределения
** Ядерные оценки плотности распределения
* Обсуждение
** Гистограмма и график плотности распределения

По результатам проделанной работы можем сделать вывод о том, что чем больше
выборка для каждого из распределений, тем ближе её гистограмма к графику
плотности вероятности того закона, по которому распределены величины
сгенерированной выборки. Чем меньше выборка, тем менее она показательна --- тем
хуже по ней определяется характер распределения величины.

Также можно заметить, что макисмумы гистограмм и плотностей распределения почти
нигде не совпали. Также наблюдаются всплески гистограмм, что наиболее хорошо
прослеживается на распределении Коши.
** Характеристики положения и рассеяния

Исходя из данных, приведённых в таблицах, можно судить о том, что дисперсия
характеристик рассеяния для распределения Коши является некой аномалией:
значения слишком большие даже при увеличении размера выборки ---  понятно, что
это результат выбросов, которые мы могли наблюдать в результатах предыдущего задания.
** Доля и теоретическая вероятность выбросов

По данным, приведённым в таблице, можно сказать, что чем больше выборка, тем
ближе доля выбросов будет к теоретической оценке. Снова доля выбросов для
распределения Коши значительно выше, чем для остальных распределений.
Равномерное распределение же в точности повторяет теоретическую оценку ---
выбросов мы не получали.

Боксплоты Тьюки действительно позволяют более наглядно и с меньшими усилиями
оценивать важные характеристики распределений. Так, исходя из полученных
рисунков, наглядно видно то, что мы довольно трудоёмко анализировали в
предыдущих частях
** Эмпирическая функция и ядерные оценки плотности распределения

Можем наблюдать на иллюстрациях с э. ф. р., что ступенчатая эмпирическая функция
распределения тем лучше приближает функцию распределения реальной выборки, чем
мощнее эта выборка. Заметим так же, что для распределения Пуассона и
равномерного распределения отклонение функций друг от друга наибольшее.

Рисунки, посвященные ядерным оценкам, иллюстрируют сближение ядерной оценки и
функции плотности вероятности для всех \(h\) с ростом размера выборки. Для
распределения Пуассона наиболее ярко видно, как сглаживает отклонения увеличение
параметра сглаживания \(h\).

В зависимости от особенностей распределений для их описания лучше подходят
разные параметры ℎ в ядерной оценке: для равномерного распределения и
распределения Пуассона лучше подойдет параметр \(h = 2h_n\), для распределения
Лапласа − \(h = h_n / 2\), а для нормального и Коши − \(h = h_n\). Такие
значения дают вид ядерной оценки наиболее близкий к плотности, характерной
данным распределениям.

Также можно увидеть, что чем больше коэффициент при параметре сглаживания
\(\hat{h_n}\), тем меньше изменений знака производной у аппроксимирующей
функции, вплоть до того, что при \(h = 2 h_n\) функция становится унимодальной
на рассматриваемом промежутке. Также видно, что при \(h = 2h_n\) по полученным
приближениям становится сложно сказать плотность вероятности какого
распределения они должны повторять, так как они очень похожи между собой.
